<!DOCTYPE html>
<html>

<head>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700,300italic,400italic,500italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,100,900,200,300,500,600,700,800' rel='stylesheet' type='text/css'>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=AM_HTMLorMML-full"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto&subset=greek-ext,cyrillic-ext,latin-ext' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="ChatUI.css">

    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

    <title>
        Mathworks - Chatroom
    </title>

    <script>
        var messageBase = new Firebase('https://mathsages.firebaseio.com/');
        
        var textArr = [];

        function clearTextbox() {
            "use strict";
            document.getElementById("inputBox").value = "";
        }

        function send(text) {
            "use strict";
            document.getElementById("messages").innerHTML += "<br><p class='message'>`" + text + "`</p>"
            
            textArr.push(text);
            console.log(textArr);
            
            var x = document.getElementsByClassName("example");
            var i;
            for (i = 0; i < x.length; i++) {
                var math = MathJax.Hub.getAllJax("messages")[i];
                var mess = textArr[i].value; 
                MathJax.Hub.Queue(["Text", math, mess]);
            }
            MathJax.Hub.Queue(["Typeset",MathJax.Hub,"MathDiv"]);
        }


        messageBase.on('child_added', function (snapshot) {
            var message = snapshot.val();
            if (message.name == getCookie("chatroomName")) {
                send(message.text);
            }
        });

        function fireBaseInt() {
            var text = document.getElementById('inputBox').value;
            var name = getCookie("chatroomName");
            messageBase.push({
                name: name,
                text: text
            });
            clearTextbox();
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1);
                if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
            }
            return "";
        }

        $("document").ready({

        });
    </script>




    <div id="title">
        <ul>
            <li>CollabMath</li>
        </ul>
    </div>
    <title>
        CollabMath - Chat
    </title>
</head>

<body>
    <div id="messages">
    </div>
    <div id="textbox">
        <div id="inputArea">
            <input type="text" id="inputBox" value="Enter Message Here" onclick="clearTextbox()" onkeydown="if (event.keyCode == 13)fireBaseInt()" />
            <input type="button" id="inputButton" value="Send" onclick="fireBaseInt()" />
        </div>
    </div>
</body>

</html>